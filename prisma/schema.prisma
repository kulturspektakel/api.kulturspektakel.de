generator prisma_client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Viewer {
  id                 String               @id @default(uuid())
  displayName        String
  email              String
  profilePicture     String?
  slackToken         String
  slackScopes        String[]
  updatedAt          DateTime             @default(now()) @updatedAt
  ClearedReservation ClearedReservation[]
}

model Area {
  id          String @id
  displayName String
  order       Int
  themeColor  String
  latitude    Float
  longitude   Float

  table           Table[]
  areaOpeningHour AreaOpeningHour[]
}

model AreaOpeningHour {
  id        Int      @id @default(autoincrement())
  area      Area     @relation(fields: [areaId], references: [id])
  startTime DateTime
  endTime   DateTime
  areaId    String
}

enum ReservationStatus {
  Pending
  Confirmed
  CheckedIn
}

model Reservation {
  id               Int               @id @default(autoincrement())
  token            String            @unique @default(uuid())
  primaryEmail     String
  primaryPerson    String
  otherPersons     String[]
  startTime        DateTime
  checkInTime      DateTime?
  endTime          DateTime
  createdAt        DateTime          @default(now())
  status           ReservationStatus @default(Pending)
  table            Table             @relation(fields: [tableId], references: [id])
  tableId          String
  checkedInPersons Int               @default(0)
  note             String?

  @@unique([tableId, startTime])
}

model ClearedReservation {
  id        Int      @id
  data      Json
  clearedBy Viewer?  @relation(fields: [viewerId], references: [id])
  clearedAt DateTime @default(now())
  viewerId  String?
}

enum TableType {
  TABLE
  ISLAND
}

model Table {
  id           String    @id @default(uuid())
  areaId       String
  maxCapacity  Int
  minOccupancy Int
  displayName  String
  type         TableType @default(TABLE)

  area Area @relation(fields: [areaId], references: [id])

  reservations Reservation[]
  @@unique([areaId, displayName])
}

model ProductList {
  id        Int         @id @default(autoincrement())
  name      String
  emoji     String?
  product   Product[]
  OrderItem OrderItem[]
}

model Product {
  id              Int     @id @default(autoincrement())
  name            String
  price           Int
  order           Int
  requiresDeposit Boolean @default(false)

  productList   ProductList @relation(fields: [productListId], references: [id])
  productListId Int
}

enum OrderPayment {
  CASH
  BON
  SUM_UP
  VOUCHER
  FREE_CREW
  FREE_BAND
}

model Device {
  id    String  @id
  Order Order[]
}

model Order {
  id        Int          @id @default(autoincrement())
  createdAt DateTime     @default(now())
  payment   OrderPayment
  tokens    Int          @default(0)
  device    Device       @relation(fields: [deviceId], references: [id])
  items     OrderItem[]
  deviceId  String
}

model OrderItem {
  id           Int          @id @default(autoincrement())
  order        Order        @relation(fields: [orderId], references: [id])
  orderId      Int
  amount       Int
  note         String?
  name         String
  perUnitPrice Int
  list         ProductList? @relation(fields: [listId], references: [id])
  listId       Int?
}
